# 网络

## 报文

1.  请求报文

```
GET /doc/index.html HTTP/1.1
Host: www.test.com
Accept: image/git,image/jpeg
Accept-Language:zh-cn
Accept-Enconding:gzip, deflate
User-Agent: Mozilla/4.0
Content-Length:35
```

2.  响应报文

```
HTTP/1.1 200 OK
Date:
Server:
Last-Modified:
ETag:
Accept-Ranges:
Content-Length:
Conenction:
Content-Type:
```

## HTTP

### HTTP 协议

1.  建立连接：三次握手
2.  断开连接：四次挥手

### GET 与 POST 区别

1.  作用
    GET 用于获取资源，POST 用于传输资源主体。
2.  参数
    GET 参数在 URL 中，POST 参数在 body 中。
3.  幂等性
    GET 是幂等的，POST 不幂等。
4.  可缓存
    GET 方法可缓存，PUT、POST、DELTE 不可缓存。
5.  发送
    POST：XHR 方法浏览器会先发送 Header 再发送 Data 两个包。
    GET:Header 和 Data 会一起发送。

### 状态码

#### 1XX 信息

100 Continue ：表明到目前为止都很正常，客户端可以继续发送请求或者忽略这个响应。

#### 2XX 成功

- 200 OK
- 204 No Content ：请求已经成功处理，但是返回的响应报文不包含实体的主体部分。一般在只需要从客户端往服务器发送信息，而不需要返回数据时使用。
- 206 Partial Content ：表示客户端进行了范围请求。响应报文包含由 Content-Range 指定范围的实体内容。

#### 3XX 重定向

- 301 Moved Permanently ：永久性重定向
- 302 Found ：临时性重定向
  301 表示旧地址 A 的资源已经被永久地移除了（这个资源不可访问了），**搜索引擎在抓取新内容的同时也将旧的网址交换为重定向之后的网址**；
  302 表示旧地址 A 的资源还在（仍然可以访问），这个重定向只是临时地从旧地址 A 跳转到地址 B，**搜索引擎会抓取新的内容而保存旧的网址。**（会被劫持）
- 303 See Other ：和 302 有着相同的功能，但是 303 明确要求客户端应该采用 GET 方法获取资源。
  注：虽然 HTTP 协议规定 301、302 状态下重定向时不允许把 POST 方法改成 GET 方法，但是大多数浏览器都会在 301、302 和 303 状态下的重定向把 POST 方法改成 GET 方法。

* 304 Not Modified ：如果请求报文首部包含一些条件，例如：If-Match，If-Modified-Since，If-None-Match，If-Range，If-Unmodified-Since，如果不满足条件，则服务器会返回 304 状态码。
* 307 Temporary Redirect ：临时重定向，与 302 的含义类似，但是 307 要求浏览器不会把重定向请求的 POST 方法改成 GET 方法。

#### 4XX 客户端错误

- 400 Bad Request ：请求报文中存在语法错误。
- 401 Unauthorized ：该状态码表示发送的请求需要有认证信息（BASIC 认证、DIGEST 认证）。如果之前已进行过一次请求，则表示用户认证失败。
- 403 Forbidden ：请求被拒绝，服务器端没有必要给出拒绝的详细理由。
- 404 Not Found ：资源未找到

#### 5XX 服务器错误

- 500 Internal Server Error ：服务器正在执行请求时发生错误。
- 503 Service Unavailable ：服务器暂时处于超负载或正在进行停机维护，现在无法处理请求。

## HTTPS

HTTP 的安全问题:

- 明文通信，内容可能被窃听
- 不验证通信方身份，通信方可能伪装
- 无法验证报文完整性，可能被篡改

HTTPs 通过使用 SSL 加密，具有加密，认证和完整性保护的特点。
SSL 在 **HTTP 应用层**上。

### 加密

1.  对称加密
    双方通过同一个密钥进行加密和解密。
    优点：运算速度快；缺点：传递密钥的安全问题

2.  非对称加密
    接收方根据算法产生一个公钥和对应的私钥，并分发公钥。发送方使用公钥加密数据，接收方通过私钥进行解密数据。
    优点：更安全；缺点：运算速度慢

3.  HTTPs 采用的加密方式
    HTTPs 采用非对称加密的方式来加密传输对称密钥(session key)，通过对称密钥加密通信。
    **证书**：通过第三方证书机构对服务器的公开密钥做数字签名的方式来进行服务器认证。
    **报文摘要**：通过加密和认证结合报文摘要来验证报文完整性。

## HTTP/2.0

### HTTP/1.x 缺陷

- 需要多个连接来实现并发和延迟缩短，浏览器客户端在同一时间，针对同一域名下的请求有一定数量限制。超过限制数目的请求会被阻塞。
- 不会压缩首部和请求
- TCP 利用率低下

### HTTP/2.0 改进

1.  首部压缩

    - HTTP/2.0 要求客户端和服务器同时维护和更新一个包含之前见过的首部字段表，从而避免了重复传输。
    - HTTP/2.0 也使用 Huffman 编码对首部字段进行压缩。

2.  服务器推送
    HTTP/2.0 在客户端请求一个资源时，会把相关的资源一起发送给客户端，客户端就不需要再次发起请求了。例如客户端请求 page.html 页面，服务端就把 script.js 和 style.css 等与之相关的资源一起发给客户端
3.  二进制分帧层
    应用层(HTTP/2)和传输层(TCP or UDP)之间增加一个二进制分帧层。消息会被分割成更小的帧。
4.  多路复用
    多路复用允许同时通过单一的 HTTP/2 连接发起多重的请求-响应消息。

## 跨域

### 产生原因

跨域问题是浏览器同源策略限制产生的。
当两个 url 的协议、子域名、主域名或端口号之一不同时，那么就不是同源的，为了安全，因而会产生跨域问题。

### 如何解决

1.  主域名相同时可以设置`document.domain`
2.  **jsonp**
    `script`标签的 src 可以跨域，可以使用 script 标签从服务器获取数据，请求时添加一个参数为 `callback=?`，?是你要执行的回调方法。
3.  利用 iframe 和 location.hash
4.  `window.name`
    name 值在不同的页面（甚至不同域名）加载后依旧存在，并且可以支持非常长的 name 值（2MB）。
5.  HTML5 postMessage
    `postMessage`可以实现跨文档传输。
6.  **cors 跨域资源共享**
    "跨域资源共享"（CORS）是在 XHR2 中拓展的能力，使用方法很简单，在服务端设置：
    ```
    Header set Access-Control-Allow-Origin \*
    ```
    这种设置将接受所有域名的跨域请求，也可以指定具体网址，也可以对域名进行限定：
    ```
    Header set Access-Control-Allow-Origin http://www.test.com
    ```
    这种方式的局限性在于要求客户端支持，并且服务端进行相关设置。在这两者满足的情况下，通过 CORS 进行跨域不仅支持所有类型的 HTTP 请求，而且开发者可以使用普通的 XMLHttpRequest 发起请求和获得数据，比起 JSONP 有更好的错误处理。
7.  图像 ping
    `<img>`标签可以跨域，可以使用`onload`和`onerror`事件来确定是否接收到响应。
    只能 GET；只能单向请求服务器。
